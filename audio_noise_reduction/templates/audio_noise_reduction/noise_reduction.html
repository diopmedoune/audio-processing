{% extends 'base.html' %}

{% block content %}


    <div class="container">
        
        <h1 class="title">Wav Audio Wind Removal</h1>
        
        <p class="subtitle">Réduisez le bruit dans vos fichiers audio grâce à des options de traitement avancées.</p>
        <img src="\static\audio_noise_reduction\img\cap.png" alt="">
        <form id="audioForm" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="form-group">
                <label for="audioFile">Ajouter un fichier audio :</label>
                <input type="file" id="audioFile" name="audio_file" required>
            </div>
                

            <div class="form-group">
                <label for="audioFormat">Choisir le format audio :</label>
                <select id="audioFormat" name="audio_format"  class="rec ">
                    <option value="wav">WAV</option>
                    <option value="mp3">MP3</option>
                    <option value="flac">FLAC</option>
                </select>
            </div>

            <button type="submit" class="btn-submit">Débruiter</button>
        </form>

        <div id="result" class="result" style="display: none;">
            <h3>Résultats :</h3>
            <p>Audio Original :</p>
            <audio id="originalAudio" controls></audio>

            <p>Audio Débruité :</p>
            <audio id="denoisedAudio" controls></audio>

        </div>
    </div>



    <script>
      $(document).ready(function () {
    $('#audioForm').submit(function (e) {
        e.preventDefault();

        let formData = new FormData(this);  // Récupère les données du formulaire

        // Récupère le token CSRF
        let csrfToken = $('input[name="csrfmiddlewaretoken"]').val();

        $.ajax({
            url: "{% url 'audio_denoise' %}",
            type: "POST",
            data: formData,
            processData: false,
            contentType: false,
            headers: {
                'X-CSRFToken': csrfToken  // Ajoute le token CSRF dans les en-têtes
            },
            success: function (response) {
                $('#result').show();
                $('#originalAudio').attr('src', response.original_audio_url);
                $('#denoisedAudio').attr('src', response.denoised_audio_url);
            },
            error: function (xhr, status, error) {
                alert("Une erreur s'est produite lors du traitement de l'audio : " + xhr.responseText);
            }
        });
    });
});

    </script>


{% endblock %}
